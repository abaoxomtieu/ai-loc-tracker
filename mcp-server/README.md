# AI Code Metrics MCP Server

MCP (Model Context Protocol) server for tracking AI agent-generated code.

## Features

- **Track Agent Code**: Track code generated by AI agents via MCP
- **Feature Completion**: Track when agents complete features
- **Metrics Resources**: Access developer and team metrics

## Installation

```bash
cd mcp-server
pip install -r requirements.txt
```

## Configuration

Set environment variable for backend URL (optional, defaults to http://localhost:8000):

```bash
export METRICS_BACKEND_URL=http://localhost:8000
```

## Running the Server

### Option 1: Run with SSE transport on a port (Recommended for Cursor)

Using the start script (automatically activates venv):

```bash
cd mcp-server
./start.sh
```

Or manually:

```bash
source "/path/to/.venv/bin/activate"
cd mcp-server
python -m src.server --transport sse --port 8001 --host localhost
```

### Option 2: Run with stdio transport (for direct Cursor integration)

```bash
python -m src.server
```

### Environment Variables

- `MCP_PORT`: Port number (default: 8001)
- `MCP_HOST`: Host address (default: localhost)
- `METRICS_BACKEND_URL`: Backend API URL (default: http://localhost:8000)

## Cursor Configuration

### For SSE transport (running on port):

Add to Cursor settings (`.cursor/mcp.json` or in Cursor settings):

```json
{
  "mcpServers": {
    "ai-code-metrics": {
      "url": "http://localhost:8001",
      "transport": "sse"
    }
  }
}
```

**Important:** Make sure the MCP server is running before starting Cursor. Use `./start.sh` to start the server.

### For stdio transport (direct integration):

```json
{
  "mcpServers": {
    "ai-code-metrics": {
      "command": "/path/to/.venv/bin/python",
      "args": ["-m", "src.server"],
      "cwd": "/path/to/mcp-server",
      "env": {
        "METRICS_BACKEND_URL": "http://localhost:8000"
      }
    }
  }
}
```

## Available Tools

### `track_agent_code`

Track code generated by AI agent.

**Parameters:**

- `code` (string): The generated code
- `file_path` (string): Path to the file
- `language` (string, optional): Programming language
- `code_type` (string, optional): "code", "test", or "documentation"
- `developer_id` (string, optional): Developer identifier

**Example:**

```python
track_agent_code(
    code="def hello():\n    print('Hello')",
    file_path="src/main.py",
    language="python",
    code_type="code",
    developer_id="dev1"
)
```

### `track_agent_feature_completion`

Track when an AI agent completes a feature.

**Parameters:**

- `feature_description` (string): Description of the feature
- `files_modified` (list): List of file paths modified
- `total_lines` (int): Total lines generated
- `developer_id` (string, optional): Developer identifier

**Example:**

```python
track_agent_feature_completion(
    feature_description="Add user authentication",
    files_modified=["src/auth.py", "tests/test_auth.py"],
    total_lines=150,
    developer_id="dev1"
)
```

## Available Resources

### `metrics://developer/{developer_id}`

Get metrics for a specific developer.

### `metrics://team`

Get team-wide metrics and leaderboard.

## Usage in Agent Workflow

When an AI agent completes a feature, it should call:

```python
# After generating code
track_agent_code(
    code=generated_code,
    file_path="src/feature.py",
    language="python",
    developer_id="agent-user"
)

# When feature is complete
track_agent_feature_completion(
    feature_description="Implemented user authentication",
    files_modified=["src/auth.py", "tests/test_auth.py"],
    total_lines=200,
    developer_id="agent-user"
)
```

## Troubleshooting

1. **Backend not reachable**: Ensure backend is running at `METRICS_BACKEND_URL`
2. **MCP connection issues**: Check Cursor configuration
3. **Import errors**: Ensure all dependencies are installed
