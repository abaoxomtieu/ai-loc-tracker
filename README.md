# AI LOC Tracker

Full-stack system for tracking Lines of Code (LOC) generated by AI, agents, and manual code. Helps measure and analyze AI usage in software development.

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cursor/Windsurf/ â”‚â”€â”€â”€â”€â–¶â”‚ VSCode Ext   â”‚â”€â”€â”€â”€â–¶â”‚   Backend   â”‚
â”‚    Copilot       â”‚     â”‚(Track Code)  â”‚     â”‚  FastAPI    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚                      â–²
                            â”‚                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  MCP Server    â”‚     â”‚  JSON/JSONL    â”‚
                    â”‚ (Agent Logs)   â”‚     â”‚    Storage     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ Project Structure

```
LOC/
â”œâ”€â”€ backend/             # FastAPI Backend - API server
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/         # API endpoints (events, metrics)
â”‚   â”‚   â”œâ”€â”€ models/      # Data models
â”‚   â”‚   â”œâ”€â”€ services/    # Business logic (aggregator, calculator)
â”‚   â”‚   â””â”€â”€ storage/     # Data storage (JSON/JSONL)
â”‚   â””â”€â”€ logs/            # Event logs storage
â”œâ”€â”€ mcp-server/          # MCP Server - Track agent code
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ server.py    # FastMCP server
â”œâ”€â”€ vscode-extension/    # VSCode Extension - Track typing
â”‚   â””â”€â”€ src/            # Extension source code
â””â”€â”€ README.md
```

## ğŸš€ Quick Start

### 1. Backend Setup

```bash
# Install dependencies
cd backend
pip install -r requirements.txt

# Run server
uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload
```

Backend will be available at:

- **API**: http://localhost:8000
- **Docs**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

### 2. MCP Server Setup (For Cursor/Windsurf)

```bash
# Install dependencies
cd mcp-server
pip install -r requirements.txt

# Run server with SSE transport
./start.sh
# Or manually:
python -m src.server --transport sse --port 8001 --host localhost
```

**Configure Cursor** (`.cursor/mcp.json`):

```json
{
  "mcpServers": {
    "ai-loc-tracker": {
      "url": "http://localhost:8001",
      "transport": "sse"
    }
  }
}
```

### 3. VSCode Extension Setup

```bash
# Build extension
cd vscode-extension
npm install
npm run build
```

Install the `.vsix` file in VSCode/Cursor:

1. `Cmd+Shift+P` â†’ `Extensions: Install from VSIX...`
2. Select file `ai-loc-tracker-0.1.0.vsix`

**Configure Extension** (Settings JSON):

```json
{
  "aiCodeMetrics.backendUrl": "http://localhost:8000",
  "aiCodeMetrics.developerId": "your-developer-id",
  "aiCodeMetrics.enabled": true
}
```

## ğŸ“Š Code Types Tracked

The system distinguishes 3 types of code:

1. **completion**: Code from AI inline completion (GitHub Copilot, Cursor inline)
2. **agent**: Code generated by AI agent via MCP
3. **manual**: Code typed manually by developer

## ğŸ”Œ API Endpoints

### Events (Send Data)

- `POST /api/events/code` - Track code insertion
- `POST /api/events/test` - Track test generation
- `POST /api/events/documentation` - Track documentation

**Example:**

```bash
curl -X POST "http://localhost:8000/api/events/code" \
  -H "Content-Type: application/json" \
  -d '{
    "source": "manual",
    "lines": 10,
    "file_path": "src/main.py",
    "language": "python",
    "developer_id": "dev1"
  }'
```

### Metrics (Get Data)

- `GET /api/metrics/developer/{developer_id}` - Developer metrics
- `GET /api/metrics/team` - Team metrics and leaderboard
- `GET /api/metrics/trends?developer_id={id}&days=30` - Time-series trends
- `GET /api/metrics/features?limit=20` - Metrics by feature
- `GET /api/metrics/health` - Health check

**Examples:**

```bash
# Get developer metrics
curl "http://localhost:8000/api/metrics/developer/dev1"

# Get team leaderboard
curl "http://localhost:8000/api/metrics/team"

# Get 30-day trends
curl "http://localhost:8000/api/metrics/trends?days=30"
```

## ğŸ› ï¸ MCP Server Tools

MCP Server provides 2 tools for AI agents:

### 1. `list_recent_features`

List recent features with their LOC counts.

### 2. `track_agent_code`

Track code generated by AI agent.

**Parameters:**

- `loc_count` (int): Total lines of code
- `feature_name` (string): Feature name (required)
- `total_files` (int): Number of files updated
- `code_type` (string): "code", "test", or "documentation"
- `developer_id` (string): Developer identifier

**Workflow:**

1. Call `list_recent_features()` first
2. Ask user to select feature (or new name)
3. Generate code and update files
4. Call `track_agent_code()` once at the end

## ğŸ“± VSCode Extension

Extension automatically tracks:

- **Manual typing**: Code you type manually
- **AI completions**: Code from Copilot/Cursor inline

**Features:**

- Automatic tracking when you type code
- Display metrics in panel (`Cmd+Shift+M`)
- Status bar item for quick access

**Debug:**

- Open Output Channel: `View â†’ Output â†’ AI LOC Tracker`
- Check logs to debug tracking issues

See [vscode-extension/README.md](vscode-extension/README.md) for detailed documentation.

## ğŸ’¾ Data Storage

Events are stored in `backend/logs/`:

- `code_insertions.json` - Code events
- `test_generations.json` - Test events
- `documentation.json` - Documentation events

Format: JSON array with event objects.

## ğŸ¯ Metrics Targets

The system supports tracking these targets:

- **AI LOC percentage**: Target 15%
- **AI-generated tests**: Target 20%
- **AI-assisted documentation**: Target 10%

## ğŸ”§ Environment Variables

### Backend

- None (uses default: `http://localhost:8000`)

### MCP Server

- `METRICS_BACKEND_URL`: Backend API URL (default: `http://localhost:8000`)
- `MCP_PORT`: Port for MCP server (default: `8001`)
- `MCP_HOST`: Host for MCP server (default: `localhost`)

## ğŸ“ Example Workflow

1. **Start Backend:**

   ```bash
   cd backend
   uvicorn src.main:app --reload
   ```

2. **Start MCP Server:**

   ```bash
   cd mcp-server
   ./start.sh
   ```

3. **Install VSCode Extension:**

   - Build and install `.vsix` file
   - Configure `developerId` in settings

4. **Use in Cursor:**

   - Agent will automatically call `track_agent_code()` when generating code
   - Extension automatically tracks manual typing

5. **View Metrics:**
   - VSCode: `Cmd+Shift+M` to open metrics panel
   - API: `GET /api/metrics/team` to view leaderboard

## ğŸ› Troubleshooting

### Backend Not Running

- Check if port 8000 is occupied
- View logs in terminal

### MCP Server Not Connecting

- Ensure MCP server is running (`./start.sh`)
- Check `.cursor/mcp.json` configuration
- View logs in terminal

### Extension Not Tracking

- Check if `developerId` is set
- Check if `enabled` = true
- View Output Channel: `View â†’ Output â†’ AI LOC Tracker`
- Ensure backend is running

## ğŸ“„ License

MIT
